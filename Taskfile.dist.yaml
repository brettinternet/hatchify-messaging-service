---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

dotenv: [.env]

includes:
  setup: .taskfiles/setup.yaml
  server: .taskfiles/server.yaml
  integration:
    dir: integration
    taskfile: .taskfiles/integration.yaml

tasks:
  default:
    silent: true
    cmd: task -l

  init:
    desc: Install dependencies and setup environment
    aliases: [setup]
    deps:
      - task: setup:init
    cmds:
      - task: server:init
      # - task: integration:init

  start:
    desc: Start server
    deps:
      - task: server:start

  check:
    desc: Run all checks
    deps:
      - task: server:check
      # - task: integration:check
    cmds:
      - dprint check
      - gitleaks git --redact --verbose --no-banner

  fix:
    desc: Run all fixes
    deps:
      - task: server:fix
      # - task: integration:fix
    cmds:
      - dprint fmt

  test:
    desc: Run all tests
    deps:
      - task: server:test
      # - task: integration:test
      - ./bin/test.sh
      - ./bin/test-more.sh

  compose:up:
    aliases: [up]
    desc: Start all services
    deps:
      - server:compose:services
    cmds:
      - task: server:compose:up
      # - task: integration:compose:up

  compose:services:
    aliases: [compose:services:up]
    desc: Start services
    deps:
      - server:compose:services

  compose:services:down:
    desc: Down services
    deps:
      - server:compose:services:down

  compose:down:
    aliases: [down]
    desc: Down services
    deps:
      - server:compose:services:down
      - server:compose:down
      # - integration:compose:down
